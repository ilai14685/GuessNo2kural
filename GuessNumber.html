<!doctype html>
<html lang="ta">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Guessing Game ‚Äî Thirukkural (500+ ready)</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    @keyframes pop { 0%{transform:scale(1)} 50%{transform:scale(1.12)} 100%{transform:scale(1)} }
    @keyframes shake { 0%{transform:translateX(0)}20%{transform:translateX(-8px)}40%{transform:translateX(8px)}60%{transform:translateX(-6px)}80%{transform:translateX(6px)}100%{transform:translateX(0)} }
    @keyframes flash { 0%{opacity:1}50%{opacity:0.2}100%{opacity:1} }

    .pop { animation: pop 600ms ease-in-out; }
    .shake { animation: shake 500ms ease-in-out; }
    .flash { animation: flash 800ms ease-in-out; }

    .card { transition: background-color .18s, color .18s, transform .12s; }
    #thirukkuralBox { display:none; background:#fffef6; border-left:4px solid #ffb74d; }
    #loader { display:none; }
    .small-muted { font-size:0.85rem; color:#6c757d; }
  </style>
</head>
<body class="bg-light">

<div class="container py-5">
  <div class="card shadow p-4" style="max-width:720px; margin:auto;">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h4 class="m-0">üéØ Guessing Game (0‚Äì9) ‚Äî 5 Attempts</h4>
      
    </div>

    <label class="form-label fw-bold">Enter your guess:</label>
    <input id="n1" type="number" min="0" max="9" class="form-control" placeholder="0 - 9">

    <div class="d-grid gap-2 mt-3">
      <button id="checkBtn" class="btn btn-primary" onclick="Guess()">Check</button>
    </div>

    <p id="msg" class="text-center fw-bold mt-3"></p>

    <div class="d-flex justify-content-between">
      <small id="attempts">Attempts: 0 / 5</small>
      <small id="hint">Hint: ‚Äî</small>
    </div>

    <!-- Thirukkural area (shown only when win) -->
    <div id="thirukkuralBox" class="p-3 mt-3 rounded">
      <h6 class="fw-bold">‚ú® ‡Æâ‡Æô‡Øç‡Æï‡Æ≥‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡Æï‡Øç ‡Æï‡Æø‡Æü‡Øà‡Æ§‡Øç‡Æ§ ‡Æ§‡Æø‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡Æ±‡Æ≥‡Øç</h6>
      <p id="kural" class="fs-5 mt-2" lang="ta"></p>
      <small class="text-muted">‡Æ§‡Æø‡Æ©‡ÆÆ‡ØÅ‡ÆÆ‡Øç ‡Æí‡Æ∞‡ØÅ ‡Æ§‡Æø‡Æ∞‡ØÅ‡Æï‡Øç‡Æï‡ØÅ‡Æ±‡Æ≥‡Øç</small>
    </div>

    <div class="d-grid gap-2 mt-3">
      <button id="restartBtn" class="btn btn-success" style="display:none" onclick="restartGame()">üîÑ Restart Game</button>
    </div>

    <div id="loader" class="mt-3 small text-muted">Fetching Thirukkural dataset‚Ä¶</div>
  </div>
</div>

<script>
/*
 Corrected version:
 - normalize fetched kurals (strings/objects) into strings
 - ensure fallback items also normalized
 - added statusSmall element (in markup) used by setStatus()
*/

const MAX_ATTEMPTS = 5;
const AUTO_RESTART_DELAY = 1800; // ms after loss to auto restart

const KURAL_URLS = [
  "https://raw.githubusercontent.com/tk120404/thirukkural/master/thirukkural.json",
  "https://raw.githubusercontent.com/nramc/thirukkural-api/main/public/data/kurals.json",
  "https://raw.githubusercontent.com/fizerkhan/thirukkural/master/data/thirukural.json",
  "https://gist.githubusercontent.com/mambaz/27f4d628aa0fbab1a4118a1ae81375d9/raw"
];

let kurals = []; // array of strings (normalized)
let r = null;
let attempts = 0;
let isOver = false;

const statusSmall = document.getElementById('statusSmall');
const loader = document.getElementById('loader');

function setStatus(text) {
  if (statusSmall) statusSmall.textContent = text;
  else console.log("STATUS:", text);
  // also keep loader visible logic elsewhere
}

// fallback small sample (objects) ‚Äî we'll normalize later


function normalizeItemToString(item) {
  // If already string, return trimmed string
  if (typeof item === 'string') return item.trim();
  if (!item) return '';
  // Try common keys
  const possible = item.kural || item.line || item.text || item.english || item.meaning;
  if (typeof possible === 'string' && possible.trim().length > 0) return possible.trim();
  // If kural & meaning both exist, combine
  if (item.kural && item.meaning) return `${String(item.kural).trim()} ‚Äî ${String(item.meaning).trim()}`;
  // fallback: take first string-like property
  for (const v of Object.values(item)) {
    if (typeof v === 'string' && v.trim().length > 0) return v.trim();
  }
  // last resort: JSON stringify (should not usually happen)
  return JSON.stringify(item);
}

async function loadKurals() {
  setStatus("Fetching kurals‚Ä¶");
  loader.style.display = 'block';

  for (const url of KURAL_URLS) {
    try {
      const resp = await fetch(url, {cache: "no-store"});
      if (!resp.ok) throw new Error("bad response");
      const data = await resp.json();
      let list = [];

      if (Array.isArray(data)) {
        if (data.length > 0 && typeof data[0] === 'string') {
          list = data.slice();
        } else if (data.length > 0 && typeof data[0] === 'object') {
          list = data.map(item => normalizeItemToString(item)).filter(Boolean);
        }
      } else if (typeof data === 'object' && data !== null) {
        if (Array.isArray(data.kurals)) list = data.kurals.map(i => normalizeItemToString(i));
        else if (Array.isArray(data.data)) list = data.data.map(i => normalizeItemToString(i));
        else {
          // maybe object with numeric keys or other shape - try to extract arrays inside
          const arrCandidate = Object.values(data).find(v => Array.isArray(v));
          if (arrCandidate) list = arrCandidate.map(i => normalizeItemToString(i));
        }
      }

      // final cleanup: ensure strings and non-empty
      list = list.map(s => (typeof s === 'string' ? s.trim() : '')).filter(Boolean);

      if (list.length >= 100) {
        kurals = list;
        setStatus(`Loaded ${kurals.length} kurals`);
        loader.style.display = 'none';
        console.log("Loaded kurals from:", url, "count:", kurals.length);
        return;
      } else {
        console.warn("Fetched list too small from", url, "count:", list.length);
      }
    } catch (err) {
      console.warn("Fetch failed for", url, err);
      // try next URL
    }
  }

  // All fetches failed or too small -> use fallback (normalize to strings)
  kurals = fallbackKurals.map(item => normalizeItemToString(item)).filter(Boolean);
  setStatus(`Using local sample (${kurals.length} kurals)`);
  loader.style.display = 'none';
  console.warn("Using fallback kurals");
}

// Initialize game state
function initGame() {
  r = Math.floor(Math.random() * 10);
  attempts = 0;
  isOver = false;
  document.getElementById('msg').textContent = "";
  document.getElementById('attempts').textContent = `Attempts: ${attempts} / ${MAX_ATTEMPTS}`;
  document.getElementById('hint').textContent = 'Hint: ‚Äî';
  document.getElementById('n1').value = "";
  document.getElementById('checkBtn').disabled = false;
  document.getElementById('thirukkuralBox').style.display = 'none';
  document.getElementById('restartBtn').style.display = 'none';
  document.querySelector('.card').classList.remove('pop','shake','flash');
  console.clear();
  console.log("Random (dev):", r);
}

// Called when user clicks Check
function Guess() {
  if (isOver) return;

  const raw = document.getElementById('n1').value;
  const val = Number(raw);
  if (raw === '' || Number.isNaN(val) || val < 0 || val > 9) {
    alert('Please enter a number between 0 and 9.');
    return;
  }

  attempts++;
  document.getElementById('attempts').textContent = `Attempts: ${attempts} / ${MAX_ATTEMPTS}`;

  // correct
  if (val === r) {
    winGame();
    return;
  }

  // wrong
  document.getElementById('msg').textContent = '‚ùå Wrong Guess! Try again.';
  document.getElementById('msg').className = 'text-danger text-center fw-semibold';
  triggerAnimation('shake');

  if (val < r) document.getElementById('hint').textContent = 'Hint: Try a higher number ‚Üë';
  else document.getElementById('hint').textContent = 'Hint: Try a lower number ‚Üì';

  // reached max attempts -> auto restart after short delay
  if (attempts >= MAX_ATTEMPTS) {
    document.getElementById('msg').textContent = `‚ö†Ô∏è Game Over! Correct number was ${r}. Restarting...`;
    document.getElementById('msg').className = 'text-warning text-center fw-bold';
    document.getElementById('checkBtn').disabled = true;
    isOver = true;
    triggerAnimation('flash');
    setTimeout(() => {
      initGame();
    }, AUTO_RESTART_DELAY + 200);
  }
}

// When user wins: show one random thirukkural and show only Restart button (no auto restart)
function winGame() {
  isOver = true;
  document.getElementById('msg').textContent = 'üéâ You are Winner!';
  document.getElementById('msg').className = 'text-success text-center fw-bold';
  document.getElementById('hint').textContent = 'Hint: Correct ‚úîÔ∏è';
  document.getElementById('checkBtn').disabled = true;

  // pick a random kural from loaded kurals (if available)
  if (kurals && kurals.length > 0) {
    const idx = Math.floor(Math.random() * kurals.length);
    const item = kurals[idx];
    // item is already normalized to string by loadKurals()/fallback normalization
    const text = (typeof item === 'string') ? item : normalizeItemToString(item);
    document.getElementById('kural').textContent = text;
    document.getElementById('thirukkuralBox').style.display = 'block';
  } else {
    document.getElementById('kural').textContent = 'No kural available.';
    document.getElementById('thirukkuralBox').style.display = 'block';
  }

  document.getElementById('restartBtn').style.display = 'block';
  triggerAnimation('pop');
}

// restart triggered by user click after win OR visible after loss (but we auto-restart on loss)
function restartGame() {
  initGame();
}

// small helper to trigger card animations
function triggerAnimation(cls) {
  const card = document.querySelector('.card');
  card.classList.remove('pop','shake','flash');
  void card.offsetWidth; // reflow
  card.classList.add(cls);
}

// Enter key submits
document.getElementById('n1').addEventListener('keydown', function(e) {
  if (e.key === 'Enter') Guess();
});

// On load: fetch kurals then init game
(async function() {
  await loadKurals();
  initGame();
})();
</script>

</body>
</html>
